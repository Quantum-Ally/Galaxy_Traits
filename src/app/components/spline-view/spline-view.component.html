<!-- Performance Monitor - Hidden for better performance -->
<!-- <div class="performance-monitor glass-panel">
  <div class="perf-header">
    <h4>Performance</h4>
    <button class="neomorphic-btn small" (click)="runStressTest()">Stress Test</button>
  </div>
  <div class="perf-metrics">
    <div class="metric">
      <span class="label">FPS:</span>
      <span class="value" [class.warning]="fps() < 30" [class.good]="fps() >= 60">{{ fps() }}</span>
    </div>
    <div class="metric">
      <span class="label">Nodes:</span>
      <span class="value">{{ performanceMetrics().nodeCount }}</span>
    </div>
    <div class="metric">
      <span class="label">Memory:</span>
      <span class="value">{{ performanceMetrics().memoryUsage | number:'1.1-1' }}MB</span>
    </div>
  </div>
</div> -->

<!-- Status Indicators -->
<div class="equilibrium-indicator glass-panel" *ngIf="isCalculatingEquilibrium">
  <div class="indicator-content">
    <div class="spinner"></div>
    <span>Calculating equilibrium positions...</span>
  </div>
</div>

<!-- Central Node Change Indicator -->
<div class="central-node-indicator glass-panel" *ngIf="centralNodeChangeInProgress">
  <div class="indicator-content">
    <div class="spinner"></div>
    <span>Changing central node and resetting simulation...</span>
  </div>
</div>

<!-- Audio Control -->
<div class="audio-control" (click)="toggleAudio()">
  <svg class="speaker-icon" viewBox="0 0 24 24" fill="currentColor">
    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
  </svg>
  <span>AUDIO</span>
</div>

<!-- Controls Panel -->
<div class="controls-panel glass-panel">
  <div class="controls-header">
    <h3>Galaxy Controls</h3>
    <button class="neomorphic-btn" (click)="toggleControls()">
      {{ showControls() ? 'Hide' : 'Show' }} Controls
    </button>
  </div>
  
  <div class="controls-content" [class.hidden]="!showControls()">
    <div class="control-group">
      <label>Number of Nodes</label>
      <input type="range" min="3" max="20" [ngModel]="numNodes()" (ngModelChange)="onNumNodesChange($event)" class="slider">
      <span class="value">{{ numNodes() }}</span>
    </div>
    
    <div class="control-group">
      <label>Number of Attributes</label>
      <input type="range" min="3" max="10" [ngModel]="numAttributes()" (ngModelChange)="onNumAttributesChange($event)" class="slider">
      <span class="value">{{ numAttributes() }}</span>
    </div>
    
    <div class="control-group">
      <label>Attraction Force</label>
      <input type="range" min="0" max="100" [ngModel]="attractionK()" (ngModelChange)="attractionK.set($event)" class="slider">
      <span class="value">{{ attractionK() }}</span>
    </div>
    
    <div class="control-group">
      <label>Repulsion Force</label>
      <input type="range" min="0" max="100" [ngModel]="repulsionK()" (ngModelChange)="repulsionK.set($event)" class="slider">
      <span class="value">{{ repulsionK() }}</span>
    </div>
    
    <div class="control-group">
      <label>Damping</label>
      <input type="range" min="0.8" max="1" step="0.01" [ngModel]="damping()" (ngModelChange)="damping.set($event)" class="slider">
      <span class="value">{{ damping() }}</span>
    </div>
    
    <div class="control-group">
      <label>Central Node Selection</label>
      <select class="neomorphic-select" (change)="onCentralNodeChange($any($event.target).value)">
        <option *ngFor="let node of nodes; let i = index" [value]="node.id" [selected]="selectedCentralNodeId() === node.id">
          {{ node.name }} {{ node.isCentral ? '(Current)' : '' }}
        </option>
      </select>
    </div>
    
    <div class="control-group">
      <label>Central Preferences (comma-separated)</label>
      <input type="text" [ngModel]="centralPreferences().join(',')" (ngModelChange)="onCentralPrefsChange($event)" class="text-input">
    </div>
    
    <div class="control-group">
      <label>Central Node Color</label>
      <div class="color-control">
        <input type="color" [ngModel]="centralNodeColor()" (ngModelChange)="onCentralNodeColorChange($event)" class="color-picker">
        <div class="color-presets">
          <button *ngFor="let preset of colorPresets" 
                  class="color-preset-btn" 
                  [style.background-color]="preset.color"
                  [title]="preset.name"
                  (click)="onCentralNodeColorChange(preset.color)">
          </button>
        </div>
        <span class="current-color-value">{{ centralNodeColor() }}</span>
      </div>
    </div>
    
    <div class="control-group">
      <label>Node Name Editor</label>
      <div class="node-name-editor">
        <!-- Node Selection for Name Editing -->
        <div class="name-edit-dropdown">
          <label>Select Node to Rename</label>
          <select 
            class="neomorphic-select" 
            [ngModel]="selectedNodeForNameEdit()" 
            (ngModelChange)="onNodeForNameEditChange($event)">
            <option value="">Choose a node...</option>
            <option *ngFor="let node of nodes" [value]="node.id">
              {{ node.name }} {{ node.isCentral ? '(Central)' : '' }}
            </option>
          </select>
        </div>
        
        <!-- Name Input Field (only show when node is selected) -->
        <div class="name-input-group" *ngIf="selectedNodeForNameEdit()">
          <label>New Name</label>
          <div class="name-input-controls">
            <input 
              type="text" 
              class="text-input" 
              [ngModel]="newNodeName()" 
              (ngModelChange)="newNodeName.set($event)"
              placeholder="Enter new name..."
              maxlength="30">
            <button 
              class="neomorphic-btn small"
              (click)="updateNodeName()"
              [disabled]="!newNodeName().trim() || newNodeName().trim() === getSelectedNodeForNameEdit()?.name"
              title="Save new name">
              💾 Save
            </button>
          </div>
          <div class="current-name-display" *ngIf="getSelectedNodeForNameEdit()">
            Current: "{{ getSelectedNodeForNameEdit()?.name }}"
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="name-edit-actions" *ngIf="selectedNodeForNameEdit()">
          <button 
            class="neomorphic-btn small" 
            (click)="resetNodeNameToOriginal()"
            title="Reset to original generated name">
            🔄 Reset
          </button>
          <button 
            class="neomorphic-btn small" 
            (click)="generateRandomName()"
            title="Generate a random name">
            🎲 Random
          </button>
        </div>
      </div>
    </div>
    
    <!-- Attribute Management Section -->
    <div class="control-group attribute-management">
      <label>Attribute Management</label>
      
      <!-- Node Selection Dropdown -->
      <div class="dropdown-group">
        <label>Select Node</label>
        <select 
          class="neomorphic-select" 
          [ngModel]="selectedNodeForAttributes()" 
          (ngModelChange)="onNodeSelectionChange($event)">
          <option value="">Choose a node...</option>
          <option *ngFor="let node of getAvailableNodes()" [value]="node.id">
            {{ node.name }} {{ node.isCentral ? '(Central)' : '' }}
          </option>
        </select>
      </div>
      
      <!-- Attribute Selection Dropdown (only show when node is selected) -->
      <div class="dropdown-group" *ngIf="selectedNodeForAttributes()">
        <label>Select Attribute</label>
        <select 
          class="neomorphic-select" 
          [ngModel]="selectedAttributeForEdit()" 
          (ngModelChange)="onAttributeSelectionChange($event)">
          <option value="-1">Choose an attribute...</option>
          <option *ngFor="let attrName of getAvailableAttributes(); let i = index" [value]="i">
            {{ attrName }}
          </option>
        </select>
      </div>
      
      <!-- Single Attribute Editor (only show when both node and attribute are selected) -->
      <div class="single-attribute-editor" *ngIf="selectedNodeForAttributes() && selectedAttributeForEdit() !== -1">
        <div class="editor-header">
          <h4>Edit {{ getSelectedNodeName() }} - {{ getSelectedAttributeName() }}</h4>
        </div>
        
        <div class="editor-content">
          <div class="attribute-item">
            <label>{{ getSelectedAttributeName() }}</label>
            <div class="attribute-controls">
              <input type="range" min="0" max="100" 
                     [ngModel]="getSelectedNodeAttributeValue()" 
                     (ngModelChange)="updateNodeAttribute(selectedNodeForAttributes()!, selectedAttributeForEdit()!, $event)"
                     class="slider">
              <input type="number" min="0" max="100" 
                     [ngModel]="getSelectedNodeAttributeValue()" 
                     (ngModelChange)="updateNodeAttribute(selectedNodeForAttributes()!, selectedAttributeForEdit()!, $event)"
                     class="number-input">
            </div>
            <div class="current-value-display">
              Current: {{ getSelectedNodeAttributeValue() }}%
            </div>
          </div>
          
          <div class="editor-actions">
            <button class="neomorphic-btn" (click)="resetSelectedAttributeToDefault()">Reset to Default</button>
          </div>
        </div>
      </div>
      
      <!-- Attribute Management Actions -->
      <div class="attribute-actions">
        <button class="neomorphic-btn" (click)="addAttribute()">+ Add Attribute</button>
        <button 
          class="neomorphic-btn small" 
          (click)="renameAttribute(selectedAttributeForEdit())" 
          [disabled]="selectedAttributeForEdit() === -1"
          title="Rename selected attribute">
          ✏️ Rename
        </button>
        <button 
          class="neomorphic-btn small danger" 
          (click)="removeAttribute(selectedAttributeForEdit())" 
          [disabled]="selectedAttributeForEdit() === -1"
          title="Remove selected attribute">
          🗑️ Remove
        </button>
      </div>
    </div>
    
    <div class="control-group">
      <button class="neomorphic-btn" (click)="forceMoveToEquilibrium()">Force Move to Equilibrium</button>
    </div>
    
    <div class="control-group">
      <button class="neomorphic-btn" (click)="generateDiverseTest()">Generate Diverse Test</button>
    </div>
  </div>
</div>


<!-- Tooltip -->
<div class="tooltip" [style.display]="tooltip().visible ? 'block' : 'none'" 
     [style.left.px]="tooltip().x" [style.top.px]="tooltip().y">
  <div class="tooltip-title">{{ tooltip().title }}</div>
  <div class="tooltip-content">{{ tooltip().content }}</div>
</div>

<!-- 3D Canvas Container -->
<div class="canvas-container">
  <canvas #threeCanvas class="three-canvas"></canvas>
</div>

<!-- Camera View Control -->
<app-camera-view-control></app-camera-view-control>